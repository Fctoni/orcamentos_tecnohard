# üéØ FASE 7: A√ß√µes em Lote e Melhorias

**Dura√ß√£o Estimada:** 1-2 dias  
**Objetivo:** Sele√ß√£o m√∫ltipla, a√ß√µes em lote e melhorias de UX

---

## üìã Checklist de Tarefas

- [ ] 7.1 Implementar sele√ß√£o m√∫ltipla na tabela
- [ ] 7.2 Criar barra de a√ß√µes em lote
- [ ] 7.3 Implementar altera√ß√£o de status em lote
- [ ] 7.4 Implementar exclus√£o em lote
- [ ] 7.5 Melhorar confirma√ß√µes de exclus√£o

---

## 7.1 Sele√ß√£o M√∫ltipla na Tabela

**Atualizar `components/features/orcamentos-list.tsx`:**

```typescript
// Adicionar state para sele√ß√£o
const [selectedIds, setSelectedIds] = useState<string[]>([])

// Fun√ß√£o para selecionar/deselecionar
const toggleSelect = (id: string) => {
  setSelectedIds(prev => 
    prev.includes(id) 
      ? prev.filter(i => i !== id)
      : [...prev, id]
  )
}

const selectAll = () => {
  if (selectedIds.length === orcamentos.length) {
    setSelectedIds([])
  } else {
    setSelectedIds(orcamentos.map(o => o.id))
  }
}
```

---

## 7.2 Checkbox na Tabela

**Atualizar tabela para incluir checkbox:**

```typescript
// No TableHeader
<TableHead className="w-[40px]">
  <Checkbox
    checked={selectedIds.length === orcamentos.length && orcamentos.length > 0}
    onCheckedChange={selectAll}
  />
</TableHead>

// No TableRow
<TableCell onClick={(e) => e.stopPropagation()}>
  <Checkbox
    checked={selectedIds.includes(orcamento.id)}
    onCheckedChange={() => toggleSelect(orcamento.id)}
  />
</TableCell>
```

---

## 7.3 Barra de A√ß√µes em Lote

**Adicionar ao `orcamentos-list.tsx`:**

```typescript
{/* Barra de a√ß√µes em lote */}
{selectedIds.length > 0 && (
  <div className="fixed bottom-6 left-1/2 -translate-x-1/2 bg-white rounded-lg shadow-lg border p-4 flex items-center gap-4 z-50">
    <span className="text-sm font-medium">
      {selectedIds.length} selecionado(s)
    </span>
    
    <Separator orientation="vertical" className="h-8" />
    
    <DropdownMenu>
      <DropdownMenuTrigger asChild>
        <Button variant="outline" size="sm">
          <RefreshCw className="mr-2 h-4 w-4" /> Alterar Status
        </Button>
      </DropdownMenuTrigger>
      <DropdownMenuContent>
        {Object.entries(STATUS_CONFIG).map(([key, config]) => (
          <DropdownMenuItem
            key={key}
            onClick={() => changeStatusBatch(key as OrcamentoStatus)}
          >
            {config.icon} {config.label}
          </DropdownMenuItem>
        ))}
      </DropdownMenuContent>
    </DropdownMenu>
    
    <Button
      variant="destructive"
      size="sm"
      onClick={() => setDeleteMultiple(true)}
    >
      <Trash2 className="mr-2 h-4 w-4" /> Excluir
    </Button>
    
    <Button
      variant="ghost"
      size="sm"
      onClick={() => setSelectedIds([])}
    >
      <X className="h-4 w-4" />
    </Button>
  </div>
)}
```

---

## 7.4 Altera√ß√£o de Status em Lote

```typescript
const changeStatusBatch = async (status: OrcamentoStatus) => {
  for (const id of selectedIds) {
    await updateStatus(id, status)
  }
  setSelectedIds([])
  toast({ title: `Status de ${selectedIds.length} or√ßamentos atualizado!` })
}
```

---

## 7.5 Exclus√£o em Lote

```typescript
const [deleteMultiple, setDeleteMultiple] = useState(false)

const handleDeleteMultiple = async () => {
  for (const id of selectedIds) {
    await deleteOrcamento(id)
  }
  setSelectedIds([])
  setDeleteMultiple(false)
  toast({ title: `${selectedIds.length} or√ßamentos exclu√≠dos!` })
}

// Dialog para exclus√£o em lote
<AlertDialog open={deleteMultiple} onOpenChange={setDeleteMultiple}>
  <AlertDialogContent>
    <AlertDialogHeader>
      <AlertDialogTitle>Excluir {selectedIds.length} or√ßamentos?</AlertDialogTitle>
      <AlertDialogDescription>
        Esta a√ß√£o n√£o pode ser desfeita. Todos os or√ßamentos selecionados,
        seus itens e anexos ser√£o removidos permanentemente.
      </AlertDialogDescription>
    </AlertDialogHeader>
    <AlertDialogFooter>
      <AlertDialogCancel>Cancelar</AlertDialogCancel>
      <AlertDialogAction 
        onClick={handleDeleteMultiple}
        className="bg-red-600 hover:bg-red-700"
      >
        Sim, excluir todos
      </AlertDialogAction>
    </AlertDialogFooter>
  </AlertDialogContent>
</AlertDialog>
```

---

## 7.6 Confirma√ß√£o de Exclus√£o Aprimorada

**Atualizar dialog de exclus√£o para mostrar detalhes:**

```typescript
<AlertDialog open={!!deleteId} onOpenChange={() => setDeleteId(null)}>
  <AlertDialogContent>
    <AlertDialogHeader>
      <AlertDialogTitle>Excluir or√ßamento?</AlertDialogTitle>
      <AlertDialogDescription className="space-y-2">
        <p>Esta a√ß√£o n√£o pode ser desfeita.</p>
        {deleteId && orcamentos.find(o => o.id === deleteId) && (
          <div className="bg-secondary rounded p-3 text-sm">
            <p><strong>N√∫mero:</strong> {orcamentos.find(o => o.id === deleteId)?.numero}</p>
            <p><strong>Cliente:</strong> {orcamentos.find(o => o.id === deleteId)?.cliente}</p>
          </div>
        )}
        <p className="text-red-600 font-medium">
          Todos os itens e anexos tamb√©m ser√£o removidos.
        </p>
      </AlertDialogDescription>
    </AlertDialogHeader>
    <AlertDialogFooter>
      <AlertDialogCancel>Cancelar</AlertDialogCancel>
      <AlertDialogAction 
        onClick={handleDelete} 
        className="bg-red-600 hover:bg-red-700"
      >
        Sim, excluir
      </AlertDialogAction>
    </AlertDialogFooter>
  </AlertDialogContent>
</AlertDialog>
```

---

## ‚úÖ Crit√©rios de Conclus√£o da Fase 7

- [ ] Checkbox de sele√ß√£o em cada linha da tabela
- [ ] Checkbox "selecionar todos" no cabe√ßalho
- [ ] Barra de a√ß√µes aparece quando h√° sele√ß√£o
- [ ] Altera√ß√£o de status em lote funcionando
- [ ] Exclus√£o em lote com confirma√ß√£o
- [ ] Confirma√ß√µes de exclus√£o mostram detalhes do or√ßamento
- [ ] Bot√£o para limpar sele√ß√£o

---

## üîó Pr√≥xima Fase

‚û°Ô∏è [FASE 8: Polimento](./FASE8.MD)
